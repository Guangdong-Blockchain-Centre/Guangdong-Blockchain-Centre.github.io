{% assign emptyarray = "" | split: "," %}
{% assign data = site.data[include.data] | default: site[include.data] | default: emptyarray | data_filter: include.filter %}

{% assign group_by_year = include.group_by_year | default: "true" %}

{% if group_by_year != "false" %}
  {% assign years = data | group_by_exp: "d", "d.date | date: '%Y'" | sort: "name" | reverse %}
  {% for year in years %}
    {% assign data = year.items %}
    {% if years.size > 1 %}
### {{ year.name }}
      {% assign data = data | sort: "date" | reverse %}
    {% endif %}
    {% for d in data %}
      {% assign style = d.style | default: include.style %}
      {% include {{ include.component | append: ".html" }} affiliation=d.affiliation author=d.author authors=d.authors buttons=d.buttons caption=d.caption content=d.content date=d.date description=d.description excerpt=d.excerpt height=d.height icon=d.icon id=d.id image=d.image last_modified_at=d.last_modified_at link=d.link lookup=d.lookup name=d.name publisher=d.publisher repo=d.repo role=d.role slug=d.slug style=style subtitle=d.subtitle tags=d.tags text=d.text title=d.title tooltip=d.tooltip type=d.type url=d.url width=d.width %}
    {% endfor %}
  {% endfor %}
{% else %}
  {% if include.sort %}
    {% assign data = data | sort: include.sort %}
  {% endif %}
  {% if include.reverse == "true" %}
    {% assign data = data | reverse %}
  {% endif %}

  {% for d in data %}
    {% assign style = d.style | default: include.style %}
    {% include {{ include.component | append: ".html" }} affiliation=d.affiliation author=d.author authors=d.authors buttons=d.buttons caption=d.caption content=d.content date=d.date description=d.description excerpt=d.excerpt height=d.height icon=d.icon id=d.id image=d.image last_modified_at=d.last_modified_at link=d.link lookup=d.lookup name=d.name publisher=d.publisher repo=d.repo role=d.role slug=d.slug style=style subtitle=d.subtitle tags=d.tags text=d.text title=d.title tooltip=d.tooltip type=d.type url=d.url width=d.width %}
  {% endfor %}
{% endif %}
